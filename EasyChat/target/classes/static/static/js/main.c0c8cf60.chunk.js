(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{101:function(e,t,a){},112:function(e,t,a){},127:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(22),i=a.n(r),o=(a(84),a(11)),c=a(12),l=a(14),h=a(13),u=a(15),d=a(7),m=a(136),p=a(129),g=a(130),v=a(39),w=a(24),f=a(23),b=a(9),E=a.n(b),C=(a(33),a(101),new f.a),y=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(h.a)(t).call(this))).state={username:"",password:"",wrongAuth:"hidden"},e.handleSubmit=e.handleSubmit.bind(Object(d.a)(e)),e}return Object(u.a)(t,e),Object(c.a)(t,[{key:"handlePw",value:function(e){this.setState({password:e})}},{key:"handleUser",value:function(e){this.setState({username:e})}},{key:"handleSubmit",value:function(e){e.preventDefault();var t,a=this;this.setState({wrongAuth:"hidden"}),t="register"!==window.location.href.split("/")[3]?"http://"+window.location.hostname+":8080/api/v1/auth/login":"http://"+window.location.hostname+":8080/api/v1/users",E.a.post(t,{username:this.state.username,password:this.state.password}).then((function(e){e.data.success?(a.setState({wrongAuth:"hidden"}),C.set("sessionId",e.data.sessionId),C.set("username",a.state.username),window.location.reload()):a.setState({wrongAuth:""})})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"Login"},s.a.createElement(v.a,null,s.a.createElement(m.a,{onSubmit:function(t){return e.handleSubmit(t,e.props)}},s.a.createElement("h2",null,"EasyChat"),s.a.createElement(m.a.Group,{controlId:"formUsername"},s.a.createElement(m.a.Label,null,"Username"),s.a.createElement(m.a.Control,{type:"text",placeholder:"Enter username",value:this.state.username,onChange:function(t){return e.handleUser(t.target.value)}})),s.a.createElement(m.a.Group,{controlId:"formPassword"},s.a.createElement(m.a.Label,null,"Password"),s.a.createElement(m.a.Control,{type:"password",placeholder:"Password",value:this.state.password,onChange:function(t){return e.handlePw(t.target.value)}})),s.a.createElement(w.c,null,s.a.createElement(w.a,{path:"/register"},s.a.createElement(p.a,{variant:"danger",style:{marginBottom:"20px"},className:this.state.wrongAuth?"hidden":""},"Username already taken"),s.a.createElement(v.b,{to:"/"},s.a.createElement(g.a,{variant:"link"},"Log in")),s.a.createElement(g.a,{variant:"primary",type:"submit"},"Sign on!")),s.a.createElement(w.a,{path:"/"},s.a.createElement(p.a,{variant:"danger",style:{marginBottom:"20px"},className:this.state.wrongAuth?"hidden":""},"Wrong username or password"),s.a.createElement(v.b,{to:"/register"},s.a.createElement(g.a,{variant:"link"},"Sign on!")),s.a.createElement(g.a,{variant:"primary",type:"submit"},"Log in!"))))))}}]),t}(n.Component),j=(a(112),a(132)),O=a(131),k=a(137),I=a(73),S=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(h.a)(t).call(this))).state={wrongUser:"hidden",wrongGroup:"hidden",newChatValue:"",newGroupValue:"",newUser1Value:"",newUser2Value:""},e.createNewChat=e.createNewChat.bind(Object(d.a)(e)),e.createNewGroup=e.createNewGroup.bind(Object(d.a)(e)),e}return Object(u.a)(t,e),Object(c.a)(t,[{key:"handlerChatValue",value:function(e){this.setState({newChatValue:e})}},{key:"createNewChat",value:function(e){e.preventDefault();var t=this;E.a.post("http://"+window.location.hostname+":8080/api/v1/chats",{name:"null",members:[this.state.newChatValue]},{params:{sessionId:this.props.sid}}).then((function(e){e.data.success?window.location.reload():t.setState({wrongUser:""})})).catch((function(e){console.log(e)}))}},{key:"createNewGroup",value:function(e){e.preventDefault();var t=this;E.a.post("http://"+window.location.hostname+":8080/api/v1/chats",{name:this.state.newGroupValue,members:[this.state.newUser1Value,this.state.newUser2Value]},{params:{sessionId:this.props.sid}}).then((function(e){e.data.success?window.location.reload():t.setState({wrongGroup:""})})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){var e=this;return s.a.createElement(k.a,{show:this.props.show,onHide:this.props.handler},s.a.createElement(k.a.Header,{closeButton:!0},s.a.createElement(k.a.Title,null,"Add chat")),s.a.createElement(k.a.Body,null,s.a.createElement(p.a,{variant:"danger",className:this.state.wrongUser},"No user found"),s.a.createElement(m.a,{onSubmit:this.createNewChat},s.a.createElement(O.a,null,s.a.createElement(I.a,{"aria-label":"Add",placeholder:"Who do you want to chat to?",value:this.state.newChatValue,onChange:function(t){return e.handlerChatValue(t.target.value)}}),s.a.createElement(O.a.Append,null,s.a.createElement(g.a,{type:"submit",variant:"outline-success"},"Add"))))),s.a.createElement(k.a.Header,null,s.a.createElement(k.a.Title,null,"Create group")),s.a.createElement(k.a.Body,null,s.a.createElement(m.a,{onSubmit:this.createNewGroup},s.a.createElement(p.a,{variant:"danger",className:this.state.wrongGroup},"Type 2 valid usernames!"),s.a.createElement(m.a.Group,null,s.a.createElement(m.a.Control,{"aria-label":"Create group",placeholder:"Name of your group",onChange:function(t){e.setState({newGroupValue:t.target.value})}})),s.a.createElement(m.a.Group,null,s.a.createElement(m.a.Control,{placeholder:"User to add",onChange:function(t){e.setState({newUser1Value:t.target.value})}})),s.a.createElement(m.a.Group,null,s.a.createElement(m.a.Control,{placeholder:"User to add",onChange:function(t){e.setState({newUser2Value:t.target.value})}})),s.a.createElement(g.a,{block:!0,type:"submit",variant:"outline-success"},"Add"))))}}]),t}(n.Component),N=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(h.a)(t).call(this))).state={members:[],wrongUser:"hidden",newUser:""},e.getMembers=e.getMembers.bind(Object(d.a)(e)),e.addToGroup=e.addToGroup.bind(Object(d.a)(e)),e}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.chatId===e.chatId&&this.props.show===e.show||this.getMembers()}},{key:"getMembers",value:function(){if(-1!==this.props.chatId){var e=this;E.a.get("http://"+window.location.hostname+":8080/api/v1/chat/"+this.props.chatId,{params:{sessionId:this.props.sid}}).then((function(t){t.data&&e.setState({members:t.data.members})})).catch((function(e){console.log(e)}))}}},{key:"handlerNewUser",value:function(e){this.setState({newUser:e.target.value})}},{key:"addToGroup",value:function(e){if(-1!==this.props.chatId){var t=this;e.preventDefault(),console.log(this.state),E.a.post("http://"+window.location.hostname+":8080/api/v1/chat/"+this.props.chatId+"/members",{username:this.state.newUser},{params:{sessionId:this.props.sid}}).then((function(e){e.data.success?(t.props.handler(),t.setState({wrongUser:"hidden",newUser:""})):t.setState({wrongUser:""})})).catch((function(e){console.log(e)}))}}},{key:"render",value:function(){var e=this;return s.a.createElement(k.a,{show:this.props.show,onHide:this.props.handler},s.a.createElement(k.a.Header,{closeButton:!0},s.a.createElement(k.a.Title,null,"Users")),s.a.createElement(k.a.Body,null,this.state.members.map((function(e,t){return s.a.createElement("p",{key:t},e.username)}))),s.a.createElement(k.a.Header,null,s.a.createElement(k.a.Title,null,"Add user")),s.a.createElement(k.a.Body,null,s.a.createElement(m.a,{onSubmit:this.addToGroup},s.a.createElement(m.a.Group,null,s.a.createElement(p.a,{variant:"danger",className:this.state.wrongUser},"Wrong username"),s.a.createElement(m.a.Control,{value:this.state.newUser,onChange:function(t){return e.handlerNewUser(t)},placeholder:"User to add"})),s.a.createElement(g.a,{block:!0,disabled:!this.props.isAdmin,type:"submit",variant:this.props.isAdmin?"outline-success":"secondary"},"Add"))))}}]),t}(n.Component),L=a(77),U=a(78),M=new f.a,A=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(h.a)(t).call(this))).state={chatList:[],showCreate:!1,showManage:!1},e.selectedChat=-1,e.managedChat=-1,e.handleShowCreate=e.handleShowCreate.bind(Object(d.a)(e)),e.handleShowManage=e.handleShowManage.bind(Object(d.a)(e)),e.handleLogout=e.handleLogout.bind(Object(d.a)(e)),e}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.getChat(),window.setInterval((function(){e.getChat()}),1e3)}},{key:"getChat",value:function(){var e=this;E.a.get("http://"+window.location.hostname+":8080/api/v1/chats",{params:{sessionId:this.props.sid}}).then((function(t){t.data.some((function(t,a){return e.state.chatList.length>0?e.state.chatList.forEach((function(n){if(n.chatId===t.chatId)return t.variant=n.variant,"warning"===t.variant&&(e.selectedChat=a),!0})):t.variant="light",!1})),e.setState({chatList:t.data})})).catch((function(e){console.log(e)}))}},{key:"changeChat",value:function(e,t){var a=Object.assign({},this.state);-1!==this.selectedChat&&(a.chatList[this.selectedChat].variant="light"),a.chatList[t].variant="warning",this.selectedChat=t,this.setState(a),this.props.setChat(e)}},{key:"handleShowCreate",value:function(){var e=Object.assign({},this.state);e.showCreate=!e.showCreate,this.setState(e)}},{key:"handleShowManage",value:function(){var e=Object.assign({},this.state);e.showManage=!e.showManage,this.setState(e)}},{key:"handleLogout",value:function(){E.a.post("http://"+window.location.hostname+":8080/api/v1/auth/logout",null,{params:{sessionId:this.props.sid}}).then((function(e){M.set("sessionId",""),window.location.reload()})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"chatsList"},s.a.createElement(j.a,{vertical:!0},s.a.createElement(g.a,{className:"chatLabel border logout",variant:"outline-danger",onClick:this.handleLogout},"Logout"),s.a.createElement(g.a,{className:"chatLabel border addChat",variant:"outline-success",onClick:this.handleShowCreate},"+ Create")),this.state.chatList.map((function(t,a){return t.members.length<3?s.a.createElement(g.a,{className:"chatLabel border",variant:t.variant,key:t.chatId,onClick:function(){return e.changeChat(t.chatId,a)}},t.members.map((function(t){return t.username!==e.props.username?t.username:null}))):s.a.createElement(O.a,{className:"border",key:t.chatId},s.a.createElement(g.a,{variant:t.variant,className:"groupLabel",onClick:function(){return e.changeChat(t.chatId,a)}},t.name),s.a.createElement(O.a.Append,{className:"groupLabelManage"},s.a.createElement(g.a,{variant:t.variant,onClick:function(a){e.managedChat=t.chatId,e.isAdmin=t.isAdmin,e.handleShowManage()}},s.a.createElement(L.a,{icon:U.a}))))})),s.a.createElement(S,{sid:this.props.sid,handler:this.handleShowCreate,show:this.state.showCreate}),s.a.createElement(N,{sid:this.props.sid,handler:this.handleShowManage,isAdmin:this.isAdmin,show:this.state.showManage,chatId:this.managedChat}))}}]),t}(n.Component),G=a(135),T=a(138),V=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(h.a)(t).call(this))).state={messageList:[]},e.ref=Object(n.createRef)(),e.iid=0,e.lastTimeRequested=-1,e.isWaiting=!1,e}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.chatId!==e.chatId&&(this.setState({messageList:[]}),this.stopRefresh(),this.getMessages(this.props.chatId,this.props.sid,0,0,0),this.startRefresh(this.props.chatId,this.props.sid)),0===e.chatId&&(this.ref.current.scrollTop=this.ref.current.scrollHeight)}},{key:"stopRefresh",value:function(){window.clearInterval(this.iid)}},{key:"startRefresh",value:function(e,t){var a=this;this.iid=window.setInterval((function(){var n=0;if(a.state.messageList.length>0){var s=a.state.messageList[a.state.messageList.length-1].timestamp;n=new Date(s).getTime()}a.getMessages(e,t,n,0,0)}),500)}},{key:"getMessages",value:function(e,t,a,n,s){if(!this.isWaiting||this.lastTimeRequested!==a){this.isWaiting=!0,this.lastTimeRequested=a;var r=this;E.a.get("http://"+window.location.hostname+":8080/api/v1/chat/"+e+"/messages",{params:{sessionId:t,from:a,to:n,n:s}}).then((function(e){r.setState({messageList:r.state.messageList.concat(e.data)}),e.data.length>0&&(r.ref.current.scrollTop=r.ref.current.scrollHeight),r.isWaiting=!1})).catch((function(e){console.log(e)}))}}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"chatMessages",ref:this.ref},0===this.state.messageList.length?s.a.createElement(p.a,{variant:"light",className:"empty-chat"}," Nothing to show: select a chat to start"):s.a.createElement(G.a,{className:"messageList"},this.state.messageList.map((function(t,a){return e.props.username!==t.sender.username?s.a.createElement("div",{key:a},s.a.createElement(T.a,{bg:"info",className:"message"},t.text,s.a.createElement("p",{className:"text-right timestamp"},t.timestamp)),s.a.createElement("p",{className:"text-left"},t.sender.username)):s.a.createElement("div",{key:a},s.a.createElement(T.a,{bg:"success",className:"message"},s.a.createElement("p",{className:"text-right"},t.text),s.a.createElement("p",{className:"text-right timestamp"},t.timestamp)),s.a.createElement("p",{className:"text-right"},"You"))}))))}}]),t}(n.Component),x=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(h.a)(t).call(this))).state={value:""},e.handleChange=e.handleChange.bind(Object(d.a)(e)),e.sendMessage=e.sendMessage.bind(Object(d.a)(e)),e}return Object(u.a)(t,e),Object(c.a)(t,[{key:"sendMessage",value:function(e){e.preventDefault();var t=this.state.value.trim();t.length<1||(E.a.post("http://"+window.location.hostname+":8080/api/v1/chat/"+this.props.chatId+"/messages",{text:t},{params:{sessionId:this.props.sid}}).then((function(e){e.data.success||alert("Message not send")})).catch((function(e){console.log(e)})),this.setState({value:""}))}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){return s.a.createElement("div",{className:"sendContainer"},s.a.createElement(m.a,{onSubmit:this.sendMessage},0===this.props.chatId?null:s.a.createElement(O.a,{size:"lg"},s.a.createElement(I.a,{as:"textarea",rows:"2","aria-label":"Send",placeholder:"Write your message!",value:this.state.value,onKeyPress:function(e){13===e.which&&(e.preventDefault(),e.target.form.dispatchEvent(new Event("submit",{cancelable:!0})))},onChange:this.handleChange}),s.a.createElement(O.a.Append,null,s.a.createElement(g.a,{type:"submit",variant:"primary"},"Send")))))}}]),t}(n.Component),D=a(133),B=a(134),W=a(74),H=new f.a,R=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(h.a)(t).call(this))).state={chatId:0},e.username=H.get("username"),e.setChat=e.setChat.bind(Object(d.a)(e)),e}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isLogged()}},{key:"isLogged",value:function(){E.a.get("http://"+window.location.hostname+":8080/api/v1/auth/check",{params:{sessionId:this.props.sid}}).then((function(e){e.data.success||(H.remove("sessionId"),window.location.reload())})).catch((function(e){console.log(e)}))}},{key:"setChat",value:function(e){this.setState({chatId:e})}},{key:"render",value:function(){return s.a.createElement("div",{className:"chat border"},s.a.createElement(D.a,null,s.a.createElement(B.a,null,s.a.createElement(W.a,{md:4},s.a.createElement(A,{className:"chatsList",username:this.username,sid:this.props.sid,setChat:this.setChat})),s.a.createElement(W.a,{md:8},s.a.createElement(V,{username:this.username,sid:this.props.sid,chatId:this.state.chatId}),s.a.createElement(x,{sid:this.props.sid,chatId:this.state.chatId})))))}}]),t}(n.Component),P=new f.a,q=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(h.a)(t).call(this))).state={sid:P.get("sessionId")},e}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"container"},void 0!==this.state.sid?s.a.createElement(R,{sid:this.state.sid}):s.a.createElement(y,null))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},79:function(e,t,a){e.exports=a(127)},84:function(e,t,a){}},[[79,1,2]]]);
//# sourceMappingURL=main.c0c8cf60.chunk.js.map